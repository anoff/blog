<!doctype html><html class=no-js lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Andreas Offenhaeuser"><meta name=description content="Andreas' personal blog"><meta name=keywords content=blog,personal,software,architecture,node,markdown,plantuml,developer><meta name=generator content="Hugo 0.54.0"><title>Configure Azure Active Directory as Authentication Provider for Gitea | Andreas&#39; Blog</title><meta name=description content="Configure Azure Active Directory as Authentication Provider for Gitea - Andreas' personal blog"><meta itemprop=name content="Configure Azure Active Directory as Authentication Provider for Gitea"><meta itemprop=description content="Configure Azure Active Directory as Authentication Provider for Gitea - Andreas' personal blog"><meta property=og:title content="Configure Azure Active Directory as Authentication Provider for Gitea"><meta property=og:description content="Configure Azure Active Directory as Authentication Provider for Gitea - Andreas' personal blog"><meta property=og:image content=/assets/gitea-aad/title.png><meta property=og:url content=//blog.anoff.io/2020-03-23-configure-azure-ad-for-gitea/><meta property=og:site_name content="Andreas' Blog"><meta property=og:type content=article><link rel=icon type=image/png href=//blog.anoff.io/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=//blog.anoff.io/favicon-16x16.png sizes=16x16><link rel=stylesheet href=/sass/combined.min.9a8554fd7b34190675c70d459f7278afe9c55f9e959f57712020dc388d6b5851.css><link rel=stylesheet href=//blog.anoff.io/adoc.css><link rel=stylesheet href=//blog.anoff.io/overwrites.css><link rel=stylesheet href=//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css></head><body class=bilberry-hugo-theme><nav class=permanentTopNav><div class=container><ul class=topnav><li><a href=//anoff.io/ target=_blank>About me</a></li><li><a href=/tags target=_self>by Tags</a></li><li><a href=//anoff.io/legal target=_blank>Legal</a></li></ul></div></nav><header><div class=container><div class=logo><a href=//blog.anoff.io class=logo><img src=/avatar.png alt>
<span class=overlay><i class="fa fa-child"></i></span></a></div><div class=titles><h3 class=title><a href=//blog.anoff.io>Andreas&#39; Blog</a></h3><span class=subtitle>Adventures of a software engineer/architect</span></div><div class="toggler permanentTopNav"><i class="fa fa-bars" aria-hidden=true></i></div></div></header><div class="main container"><div class="article-wrapper u-cf single"><a class=bubble href=/2020-03-23-configure-azure-ad-for-gitea/><i class="fa fa-fw fa-pencil"></i></a><article class="default article"><div class=featured-image><a href=/2020-03-23-configure-azure-ad-for-gitea/><img src=/assets/gitea-aad/title.png alt></a></div><div class=content><h3><a href=/2020-03-23-configure-azure-ad-for-gitea/>Configure Azure Active Directory as Authentication Provider for Gitea</a></h3><div class=meta><span class="date moment">2019-03-23</span>
<span class=readingTime>3 min read</span>
<span class=author><a href=/author/anoff>anoff</a></span></div><p><a href=https://gitea.io/en-us/>Gitea</a> is an open source git hosting platform, written in Go forked from the Gogs project and seems to be highly inspired by GitHub.
If you want to host your own git platform and want to use <strong>Azure Active Directory</strong> as an authentication provider - this post might help you.</p><p><section class="doc-section level-1"><h2 id=_authentication_providers>Authentication Providers</h2><p>Instead of managing credentials in your application you can use external authentication providers (AP) to deal with user authentication.
The most common scenario nowadays is the <a href=https://en.wikipedia.org/wiki/OAuth>OAUTH</a> protocol.
Using an AP not only makes your life as a service developer/admin easier but also the user because he can reuse his identity from other services.</p><figure class=image-block><img src=/assets/gitea-aad/auth-sources.png alt="Gitea Screenshot"><figcaption>Figure 1. Gitea authentication sources (v.9f33aa6)</figcaption></figure><figure class=image-block><img src=/assets/gitea-aad/auth-sources.png alt="Gitea Screenshot"><figcaption>Figure 2. Gitea OAUTH providers (v.9f33aa6)</figcaption></figure><p>Gitea supports several authentication types and when it comes to OAUTH also several providers. The one we will use for including <strong>Azure Active Directory</strong> is the <a href=https://openid.net/connect/>OpenID Connect</a> provider that actually exposes a common standard for authentication providers to use, so applications like Gitea do not have to implement individual OAUTH providers.</p><p>We will be using the <a href=https://docs.microsoft.com/en-us/azure/active-directory/develop/v2-oauth2-auth-code-flow>OAuth 2.0 auth code grant</a>.</p></section><section class="doc-section level-1"><h2 id=_creating_an_azure_ad_application>Creating an Azure AD application</h2><aside class="admonition-block note" role=note><h6 class="block-title label-only"><span class=title-label>Note:</span></h6><p>This guide uses the <em>App registrations Preview</em>, if you use the classic app registrations you can just create a <code>native</code> application.</p></aside><p>The first step is to create an application on Azure, head over to <a href=https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/RegisteredAppsPreview>AAD - App Registrations</a> in the portal and register a new application:</p><div class=ulist><ul><li><strong>name</strong>: irrelevant for the setup, will be presented to the user when asking for his permissions</li><li><strong>type</strong>: web</li><li><strong>redirect URI</strong>: <code>&lt;host&gt;/user/oauth2/&lt;Authentication Name&gt;/callback</code> as a callback URL where <code>&lt;Authentication Name&gt;</code> is a value you will specify in the next chapter e.g. <em>AAD</em>, <em>Azure Auth</em></li></ul></div><p>For Azure to implement the correct authorization flow (<code>code</code>) we need to change our <strong>application type</strong> to <code>native</code>, this can be done via the <em>Manage &#8594; Authentication</em> blade in the Azure Portal. Set The default application type to <code>Yes</code>. In case the UI changes make sure to look out for <em>Device code flow</em> and make sure it is configured to use this method.</p><figure class=image-block><img src=/assets/gitea-aad/app-native.png alt="Azure Portal Screenshot"><figcaption>Figure 3. Change registered app from web to native type (App registrations Preview)</figcaption></figure><p>Scroll up on the same page and make sure you have a Redirect URI of type <code>Web</code> set correctly.</p><p>Finally we need to create a <strong>Client secret</strong> by going to the <em>Manage &#8594; Certificates &amp; secrets</em> panel and add a new client secret.</p><section class="admonition-block caution" role=doc-notice><h6 class="block-title label-only"><span class=title-label>Caution:</span></h6><p>Make sure to copy the secret as it is created - you will not be able to access it later.</p></section><figure class=image-block><img src=/assets/gitea-aad/app-secret.png alt="Azure Portal Screenshot"><figcaption>Figure 4. Create client secret (App registrations Preview)</figcaption></figure><p>For the configuration in Gitea you need the following values from your Azure App registration:</p><div class="olist arabic"><ol class=arabic><li><strong>Client Secret</strong></li><li><strong>Client ID</strong>: go to the application <em>Overview</em> and copy the Application (client) ID string</li><li><strong>OpenID URL</strong>: <code><a class=bare href=https://login.microsoftonline.com/&lt;tenant&gt;/v2.0/.well-known/openid-configuration>https://login.microsoftonline.com/&lt;tenant&gt;/v2.0/.well-known/openid-configuration</a></code> where you can find your tenant also in the <em>Overview</em> tab as Directory (tenant) ID</li></ol></div></section><section class="doc-section level-1"><h2 id=_add_authentication_source_in_gitea>Add Authentication Source in Gitea</h2><p>On the Gitea administration page select <em>Authentication Sources</em> and create a new one:</p><div class=ulist><ul><li><strong>Authentication Type</strong>: OAuth2</li><li><strong>Authentication Name</strong>: the same name you used for defining the callback URL in the previous step (e.g. <em>AAD</em>, <em>Azure AD</em>)</li><li><strong>OAuth2 Provider</strong>: OpenID Connect</li><li><strong>Client ID</strong>, <strong>Client Secret</strong> and <strong>OpenID Connect URL</strong> as previously specified</li></ul></div><figure class=image-block><img src=/assets/gitea-aad/gitea-auth.png alt="Gitea Auth Screenshot"><figcaption>Figure 5. Configured Gitea Azure AD Authentication Source (v.9f33aa6)</figcaption></figure><p>If you are having issues following this guide or find information being outdated feel free to leave a comment or reach out via <a href=https://twitter.com/an0xff>Twitter</a> ðŸ‘‹</p></section></div><div class=footer><div class=tags><i class="fa fa-tags"></i><div class=links><a href=/tags/gitea>gitea</a>
<a href=/tags/azure>azure</a></div></div></div></article></div><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"anoff-io"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><footer><div class=container><div class=right><div class=external-profiles><strong>Social media</strong>
<a href=//twitter.com/an0xff target=_blank><i class="fa fa-twitter-adblock-proof"></i></a><a href=//github.com/anoff target=_blank><i class="fa fa-github"></i></a><a href=//linkedin.com/in/offenhaeuser/ target=_blank><i class="fa fa-linkedin"></i></a></div></div></div></footer><div class=credits><div class=container><div class=copyright><a href=//anoff.io target=_blank>&copy;
2019
by Andreas Offenhaeuser</a></div><div class=author><a href=//github.com/Lednerb/bilberry-hugo-theme target=_blank>Bilberry Hugo Theme</a></div></div></div><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-93890295-4','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src=/js/externalDependencies.39c47e10e241eae2947b3fe21809c572.js integrity="md5-OcR&#43;EOJB6uKUez/iGAnFcg=="></script><script type=text/javascript src=/js/theme.ff50ae6dc1bfc220b23bf69dbb41b54e.js integrity="md5-/1CubcG/wiCyO/adu0G1Tg=="></script><script>$(".moment").each(function(){$(this).text(moment($(this).text()).locale("en").format('LL'));});$(".footnote-return sup").html("");</script><script src=//blog.anoff.io/fix-adoc.js type=application/javascript></script><script src=//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js type=application/javascript></script><script src=//blog.anoff.io/init-cookieconsent.js type=application/javascript></script></body></html>