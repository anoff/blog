<!doctype html>
<html class="no-js" lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="author" content="Andreas Offenhaeuser">
        <meta name="description" content="Andreas&#39; personal blog">
        <meta name="keywords" content="blog,personal,software,architecture,node,markdown,plantuml,developer">
        <meta name="generator" content="Hugo 0.55.6" />
        <title> Configure Azure Active Directory as Authentication Provider for Gitea | Andreas&#39; Blog</title>
        <meta name="description" content="Configure Azure Active Directory as Authentication Provider for Gitea - Andreas&#39; personal blog">
        <meta itemprop="name" content="Configure Azure Active Directory as Authentication Provider for Gitea">
        <meta itemprop="description" content="Configure Azure Active Directory as Authentication Provider for Gitea - Andreas&#39; personal blog">
        <meta property="og:title" content="Configure Azure Active Directory as Authentication Provider for Gitea">
        <meta property="og:description" content="Configure Azure Active Directory as Authentication Provider for Gitea - Andreas&#39; personal blog">
        <meta property="og:image" content="/assets/gitea-aad/title.png">
        <meta property="og:url" content="https://blog.anoff.io/2019-03-23-configure-azure-ad-for-gitea/">
        <meta property="og:site_name" content="Andreas&#39; Blog">
        <meta property="og:type" content="article">
        <link rel="icon" type="image/png" href="https://blog.anoff.io/favicon-32x32.png" sizes="32x32">
        <link rel="icon" type="image/png" href="https://blog.anoff.io/favicon-16x16.png" sizes="16x16">

	
	  <link href="/2019-03-23-configure-azure-ad-for-gitea/" rel="alternate" type="application/rss+xml" title="Andreas&#39; Blog" />
	  <link href="/2019-03-23-configure-azure-ad-for-gitea/" rel="feed" type="application/rss+xml" title="Andreas&#39; Blog" />
	

        
        
        
        
        <link rel="stylesheet" href="/sass/combined.min.e59b3a385f4eecf22b37689781c927e19eb7f9f3c17f6dc4704f3e8a26dece8c.css">

        

        
            
                <link rel="stylesheet" href="https://blog.anoff.io/adoc.css">
            
                <link rel="stylesheet" href="https://blog.anoff.io/overwrites.css">
            
                <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css">
            
        
    </head>
    <body class="bilberry-hugo-theme">
        
<nav class="permanentTopNav">

    <div class="container">
        <ul class="topnav">
            
                
                    <li><a href="//anoff.io/" target="_self">About me</a></li>
                
            
                
                    <li><a href="/" target="_self">Blog</a></li>
                
            
                
                    <li><a href="//anoff.io/project/" target="_self">Projects</a></li>
                
            
                
                    <li><a href="/tags" target="_self">by Tags</a></li>
                
            
                
                    <li><a href="//radar.anoff.io" target="_blank">Tech skills</a></li>
                
            
                
                    <li><a href="//anoff.github.io/legal/" target="_blank">Legal</a></li>
                
            
        </ul>

        
    </div>
</nav>


        <header>
    <div class="container">
        <div class="logo">
            <a href="/" class="logo">
                
                    <img src="/avatar.png" alt="">
                

                <span class="overlay"><i class="fa fa-child"></i></span>
            </a>
        </div>
        <div class="titles">
            <h3 class="title"><a href="/">Andreas&#39; Blog</a></h3>
            
                <span class="subtitle">Adventures of a software engineer/architect</span>
            
        </div>

    

        
        <div class="toggler permanentTopNav">
        
            <i class="fa fa-bars" aria-hidden="true"></i>
        </div>
    </div>
</header>


        <div class="main container">
            
     
    <div class="article-wrapper u-cf single">
        
            <a class="bubble" href="https://blog.anoff.io/2019-03-23-configure-azure-ad-for-gitea/">
    <i class="fa fa-fw fa-pencil"></i>
</a>

<article class="default article">
    
    <div class="featured-image">
        <a href="https://blog.anoff.io/2019-03-23-configure-azure-ad-for-gitea/">
            <img src="/assets/gitea-aad/title.png" alt="">
        </a>
    </div>


    <div class="content">
    <h3><a href="https://blog.anoff.io/2019-03-23-configure-azure-ad-for-gitea/">Configure Azure Active Directory as Authentication Provider for Gitea</a></h3>
    <div class="meta">
        
            
                <span class="date moment">2019-03-23</span>
            
        

        
            <span class="readingTime">3 min read</span>
        

        

        
            <span class="author"><a href="/author/anoff">anoff</a></span>
        
    </div>

    
        <div class="paragraph">
<p><a href="https://gitea.io/en-us/">Gitea</a> is an open source git hosting platform, written in Go forked from the Gogs project and seems to be highly inspired by GitHub.
If you want to host your own git platform and want to use <strong>Azure Active Directory</strong> as an authentication provider - this post might help you.</p>
</div>
<div class="paragraph">
<p>Used abbreviations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>AP: Authentication Provider</p>
</li>
<li>
<p>AD: Active Directory</p>
</li>
<li>
<p>AAD: Azure Active Directory</p>
</li>
</ul>
</div>
<div class="sect1">
<h2 id="_authentication_providers">Authentication Providers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Instead of managing credentials in your application you can use external authentication providers (AP) to deal with user authentication.
The most common scenario nowadays is the <a href="https://en.wikipedia.org/wiki/OAuth">OAUTH</a> protocol.
Using an AP not only makes your life as a service developer/admin easier but also the user because he can reuse his identity from other services.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/gitea-aad/auth-sources.png" alt="Gitea Screenshot">
</div>
<div class="title">Figure 1. Gitea authentication sources (v.9f33aa6)</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/gitea-aad/auth-sources.png" alt="Gitea Screenshot">
</div>
<div class="title">Figure 2. Gitea OAUTH providers (v.9f33aa6)</div>
</div>
<div class="paragraph">
<p>Gitea supports several authentication types and when it comes to OAUTH also several providers. The one we will use for including <strong>Azure Active Directory</strong> is the <a href="https://openid.net/connect/">OpenID Connect</a> provider that actually exposes a common standard for authentication providers to use, so applications like Gitea do not have to implement individual OAUTH providers.</p>
</div>
<div class="paragraph">
<p>We will be using the <a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/v2-oauth2-auth-code-flow">OAuth 2.0 auth code grant</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_creating_an_azure_ad_application">Creating an Azure AD application</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This guide uses the <em>App registrations Preview</em>, if you use the classic app registrations you can just create a <code>native</code> application.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The first step is to create an application on Azure, head over to <a href="https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/RegisteredAppsPreview">AAD - App Registrations</a> in the portal and register a new application:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>name</strong>: irrelevant for the setup, will be presented to the user when asking for his permissions</p>
</li>
<li>
<p><strong>type</strong>: web</p>
</li>
<li>
<p><strong>redirect URI</strong>: <code>&lt;host&gt;/user/oauth2/&lt;Authentication Name&gt;/callback</code> as a callback URL where <code>&lt;Authentication Name&gt;</code> is a value you will specify in the next chapter e.g. <em>AAD</em>, <em>Azure Auth</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For Azure to implement the correct authorization flow (<code>code</code>) we need to change our <strong>application type</strong> to <code>native</code>, this can be done via the <em>Manage &#8594; Authentication</em> blade in the Azure Portal. Set The default application type to <code>Yes</code>. In case the UI changes make sure to look out for <em>Device code flow</em> and make sure it is configured to use this method.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/gitea-aad/app-native.png" alt="Azure Portal Screenshot">
</div>
<div class="title">Figure 3. Change registered app from web to native type (App registrations Preview)</div>
</div>
<div class="paragraph">
<p>Scroll up on the same page and make sure you have a Redirect URI of type <code>Web</code> set correctly.</p>
</div>
<div class="paragraph">
<p>Finally we need to create a <strong>Client secret</strong> by going to the <em>Manage &#8594; Certificates &amp; secrets</em> panel and add a new client secret.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
Make sure to copy the secret as it is created - you will not be able to access it later.
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/gitea-aad/app-secret.png" alt="Azure Portal Screenshot">
</div>
<div class="title">Figure 4. Create client secret (App registrations Preview)</div>
</div>
<div class="paragraph">
<p>For the configuration in Gitea you need the following values from your Azure App registration:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Client Secret</strong></p>
</li>
<li>
<p><strong>Client ID</strong>: go to the application <em>Overview</em> and copy the Application (client) ID string</p>
</li>
<li>
<p><strong>OpenID URL</strong>: <code><a href="https://login.microsoftonline.com/&lt;tenant&gt;/v2.0/.well-known/openid-configuration" class="bare">https://login.microsoftonline.com/&lt;tenant&gt;/v2.0/.well-known/openid-configuration</a></code> where you can find your tenant also in the <em>Overview</em> tab as Directory (tenant) ID</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_add_authentication_source_in_gitea">Add Authentication Source in Gitea</h2>
<div class="sectionbody">
<div class="paragraph">
<p>On the Gitea administration page select <em>Authentication Sources</em> and create a new one:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Authentication Type</strong>: OAuth2</p>
</li>
<li>
<p><strong>Authentication Name</strong>: the same name you used for defining the callback URL in the previous step (e.g. <em>AAD</em>, <em>Azure AD</em>)</p>
</li>
<li>
<p><strong>OAuth2 Provider</strong>: OpenID Connect</p>
</li>
<li>
<p><strong>Client ID</strong>, <strong>Client Secret</strong> and <strong>OpenID Connect URL</strong> as previously specified</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/gitea-aad/gitea-auth.png" alt="Gitea Auth Screenshot">
</div>
<div class="title">Figure 5. Configured Gitea Azure AD Authentication Source (v.9f33aa6)</div>
</div>
<div class="paragraph">
<p>If you are having issues following this guide or find information being outdated feel free to leave a comment or reach out via <a href="https://twitter.com/anoff_io">Twitter</a> ðŸ‘‹</p>
</div>
</div>
</div>
    
</div>

    
<div class="footer">


    
        <div class="tags">
            <i class="fa fa-tags"></i>
            <div class="links">
                
                    <a href="/tags/gitea">gitea</a>
                
                    <a href="/tags/azure">azure</a>
                
            </div>
        </div>
    

    
</div>

</article>

        
    </div>

    
        <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "anoff-io" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    

     

        </div>

        
<footer>
    <div class="container">

        

        

        <div class="right">
            
            <div class="external-profiles">
                <strong>Social media</strong>

                
                
                    <a href="//twitter.com/anoff_io" target="_blank"><i class="fa fa-twitter-adblock-proof"></i></a>
                
                
                
                
                
                
                
                
                
                    <a href="//github.com/anoff" target="_blank"><i class="fa fa-github"></i></a>
                
                
                    <a href="//linkedin.com/in/offenhaeuser/" target="_blank"><i class="fa fa-linkedin"></i></a>
                
            </div>
            

            
        </div>
    </div>
</footer>


<div class="credits">
    <div class="container">
        <div class="copyright">
            <a href="//anoff.io" target="_blank">
                &copy;
                
                    2019
                
                by Andreas Offenhaeuser
            </a>
	    
        </div>
        <div class="author">
            <a href="//github.com/Lednerb/bilberry-hugo-theme" target="_blank">Bilberry Hugo Theme</a>
        </div>
    </div>
</div>


        
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-93890295-4', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


        

        
        
        <script type="text/javascript" src="/js/externalDependencies.d9216f6db8fba82175fa5f40d0bb9b8c.js" integrity="md5-2SFvbbj7qCF1&#43;l9A0LubjA=="></script>

        
        
        <script type="text/javascript" src="/js/theme.d1b29b9e0ef43ea877f514c7e101a399.js" integrity="md5-0bKbng70Pqh39RTH4QGjmQ=="></script>

        <script>
            $(".moment").each(function() {
                $(this).text(
                    moment( $(this).text() )
                        .locale( "en" )
                        .format('LL')
                );
            });

            $(".footnote-return sup").html("");
        </script>

        
            
                <script src="https://blog.anoff.io/fix-adoc.js" type="application/javascript"></script>
            
                <script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js" type="application/javascript"></script>
            
                <script src="https://blog.anoff.io/init-cookieconsent.js" type="application/javascript"></script>
            
        

        


    </body>
</html>
