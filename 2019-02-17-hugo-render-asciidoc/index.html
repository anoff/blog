<!doctype html><html class=no-js lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Andreas Offenhaeuser"><meta name=description content="Andreas' personal blog"><meta name=keywords content=blog,personal,software,architecture,node,markdown,plantuml,developer><meta name=generator content="Hugo 0.54.0"><title>Get Hugo to render (nice) Asciidocs | Andreas&#39; Blog</title><meta name=description content="Get Hugo to render (nice) Asciidocs - Andreas' personal blog"><meta itemprop=name content="Get Hugo to render (nice) Asciidocs"><meta itemprop=description content="Get Hugo to render (nice) Asciidocs - Andreas' personal blog"><meta property=og:title content="Get Hugo to render (nice) Asciidocs"><meta property=og:description content="Get Hugo to render (nice) Asciidocs - Andreas' personal blog"><meta property=og:image content=https://blog.anoff.io/assets/hugo-asciidoc/vladimir-kramer-145-unsplash.jpg><meta property=og:url content=https://blog.anoff.io/2019-02-17-hugo-render-asciidoc/><meta property=og:site_name content="Andreas' Blog"><meta name=twitter:image content=https://blog.anoff.io/assets/hugo-asciidoc/vladimir-kramer-145-unsplash.jpg><meta property=og:type content=article><link rel=icon type=image/png href=https://blog.anoff.io/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=https://blog.anoff.io/favicon-16x16.png sizes=16x16><link rel=stylesheet href=/sass/combined.min.52f29c7c50b8b42d07e557633ac1b4544e3f91c2f3a5bb0ab34dcd0e14b4e38e.css><link rel=stylesheet href=https://blog.anoff.io/adoc.css><link rel=stylesheet href=https://blog.anoff.io/overwrites.css><link rel=stylesheet href=//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css></head><body class=bilberry-hugo-theme><nav class=permanentTopNav><div class=container><ul class=topnav><li><a href=//anoff.io/ target=_self>About me</a></li><li><a href=/ target=_self>Blog</a></li><li><a href=/tags target=_self>by Tags</a></li><li><a href=//radar.anoff.io target=_blank>Tech skills</a></li><li><a href=//anoff.io/legal target=_blank>Legal</a></li></ul></div></nav><header><div class=container><div class=logo><a href=/ class=logo><img src=/avatar.png alt>
<span class=overlay><i class="fa fa-child"></i></span></a></div><div class=titles><h3 class=title><a href=/>Andreas&#39; Blog</a></h3><span class=subtitle>Adventures of a software engineer/architect</span></div><div class="toggler permanentTopNav"><i class="fa fa-bars" aria-hidden=true></i></div></div></header><div class="main container"><div class="article-wrapper u-cf single"><a class=bubble href=/2019-02-17-hugo-render-asciidoc/><i class="fa fa-fw fa-code"></i></a><article class="default article"><div class=featured-image><a href=/2019-02-17-hugo-render-asciidoc/><img src=/assets/hugo-asciidoc/vladimir-kramer-145-unsplash.jpg alt></a></div><div class=content><h3><a href=/2019-02-17-hugo-render-asciidoc/>Get Hugo to render (nice) Asciidocs</a></h3><div class=meta><span class="date moment">2019-02-17</span>
<span class=readingTime>5 min read</span>
<span class=author><a href=/author/anoff>anoff</a></span></div><p>While migrating my blog from Jekyll to Hugo I went down quite a rabbit hole.
While setup and migration to Hugo was a breeze, I spent a lot of time making my <code>.adoc</code> formatted post work with the new blog.
After working through several GitHub issues I ended up manipulating the DOM with Javascript to get admonitions working.
It still doesn&#8217;t feel right - but hey it works! ü§∑‚Äç‚ôÇÔ∏è
This post will cover the steps I took in case I myself or anyone out there ever needs to do this again.</p><p>The following tool versions were used:</p><div class=ulist><ul><li>hugo v0.54.0</li><li>Asciidoctor 1.5.8</li><li>Firefox 65.0</li><li>Fontawesome 4.7.0</li></ul></div><section class="admonition-block warning" role=doc-notice><h6 class="block-title label-only"><span class=title-label>Warning:</span></h6><p>This post contains a lot of hacks that might be obsolete by the time you read this; please check for alternatives before you hurt yourself for no reason</p></section><section class="doc-section level-1"><h2 id=_getting_hugo_to_parse_asciidoc>Getting Hugo to parse Asciidoc</h2><p>Initial support for Asciidoc is already provided by the latest Hugo versions due to the concept of <em>External Helpers</em>.
A really neat trick that allows compatibility with any markup language that ships a binary for compilation.</p><div class=quote-block><blockquote><p>Hugo has a new concept called external helpers. It means that you can write your content using Asciidoc, reStructuredText, or pandoc.
If you have files with associated extensions, Hugo will call external commands to generate the content. (See the Hugo source code for external helpers.)
For example, for Asciidoc files, Hugo will try to call the Asciidoctor or asciidoc command.
This means that you will have to install the associated tool on your machine to be able to use these formats. ‚∏∫ <a href=//gohugo.io/content-management/formats/#additional-formats-through-external-helpers>the Hugo docs</a></p></blockquote></div><p>So all there is to do, is to install the <a href=//asciidoctor.org/>Asciidoctor toolchain</a> on the machine you are running hugo - or CI server respectively.
But because Hugo calls the Asciidoctor binary using the <code>--safe</code> parameter lists get rendered with additional paragraphs resulting in weird layout.
The line break after each list number is something that really breaks the reading flow.</p><figure class=image-block><img src=/assets/hugo-asciidoc/list-breaks.png alt="Broken lists in HTML"><figcaption>Figure 1. Ordered list with unwanted line breaks</figcaption></figure><p>I stumbled upon the GitHub issue <a href=//github.com/gohugoio/hugo/issues/1437#issuecomment-462270099>hugo#1437</a> that led me to the first hack inspired by <a href=//ratfactor.com/hugo-adoc-html5s/>David Gauer</a>.</p><section class="doc-section level-2"><h3 id=_the_asciidoctor_binary_hack>The Asciidoctor binary hack</h3><p>Since Hugo does not allow you to modify the arguments passed to the Asciidoctor toolchain it also does not support using Asciidoctor with extensions.
However since Hugo only performs a system call we can use <code>PATH</code> trickery to mix in our wishlist before the execution.</p><p>The first step is to create a shadow executable that Hugo will use instead of the installed Asciidoctor binary.
This is an executable bash script calling the <em>real</em> Asciidoctor binary with additional arguments.
To find the position of your Asciidoctor binary use <code>which asciidoctor</code> in your terminal.</p><figure class=listing-block><figcaption>./asciidoctor</figcaption><pre class=highlight><code class=language-bash data-lang=bash>#!/bin/bash
/usr/local/bin/asciidoctor -r asciidoctor-html5s -b html5s -r asciidoctor-diagram "$@"</code></pre></figure><p>Note that this does not change the arguments specified by Hugo itself it merely adds additional modules.
It should be possible with more bash code to actually remove the <code>--safe</code> flag from the list of arguments that is passed on by <code>$@</code>.</p><p>To make Hugo use this executable name it <code>asciidoctor</code> and place it in the root directory of your Hugo project.
When calling Hugo just append the current directory to the <code>PATH</code> variable with highest priority, this will make Hugo our bash script which in turn calls the real Asciidoctor binary.</p><div class=listing-block><pre class=highlight><code class=language-bash data-lang=bash># make the file an executable (only once)
chmod +x ./asciidoctor
# calling hugo in dev mode
PATH=$PWD:$PATH hugo server -D</code></pre></div><p>Forcing Asciidoctor to generate <em>semantic HTML5</em> fixes the list layout and removes the additional <code>&lt;p&gt;</code> tags around the list item content.</p><figure class=listing-block><figcaption>Clean HTML output by using <code>asciidoctor-html5s</code></figcaption><pre class=highlight><code class=language-html data-lang=html>&lt;ol class="arabic"&gt;
  &lt;li&gt;Antora expects all documentation to be part of a &lt;em&gt;component&lt;/em&gt;
    &lt;ol class="loweralpha" type="a"&gt;
      &lt;li&gt;any asciidoc file can reference or include files from other components within the same Antora project&lt;/li&gt;
    &lt;/ol&gt;
  &lt;/li&gt;
  &lt;li&gt;the playbook can define multiple content sources
    &lt;ol class="loweralpha" type="a"&gt;
      &lt;li&gt;each content source needs to point to a root directory of a git repo (local or remote)&lt;/li&gt;
      &lt;li&gt;the repo must have at least one commit&lt;/li&gt;
    &lt;/ol&gt;
  &lt;/li&gt;
&lt;/ol&gt;</code></pre></figure></section></section><section class="doc-section level-1"><h2 id=_styling_the_html_output>Styling the HTML output</h2><p>The next issue I had was that AsciiDoc admonitions looked pretty lame.
This is caused by the use of <code>asciidoctor-html5s</code> and <a href=//github.com/jirutka/asciidoctor-html5s/issues/11>expected behavior</a> by the author.</p><figure class=image-block><img src=/assets/hugo-asciidoc/admonitions.png alt="Unstyled admonitions"><figcaption>Figure 2. Semantic HTML5 Asciidoctor admonitions with HTML source</figcaption></figure><p>The author of the semantic HTML5 Asciidoctor extension suggests hiding the text label and adding a background color with the admonition icon.
I tried it and it works fine but I did not want to add icons for the admonitions to my list of assets.
Instead I applied the DOM layout and CSS style that the <a href=//gitlab.com/antora/antora-ui-default/>Antora UI project</a> uses for admonitions.</p><section class="doc-section level-2"><h3 id=_manipulating_the_dom_for_custom_css>Manipulating the DOM for custom CSS</h3><p>The Hugo theme I am using allows for custom Javascript and CSS to be injected which makes this hack quite easy to implement.
I wrote a piece of Javascript that looks for <code>admonition-block</code> elements and extracts the admonition <strong>type</strong> and admonition <strong>text</strong> from the DOM element.
By constructing a new DOM element using a <code>&lt;table&gt;</code> structure and replacing the original block I can style the table cells using <code>adoc.css</code>.</p><figure class=listing-block><figcaption>fix-adoc.js</figcaption><pre class=highlight><code class=language-javascript data-lang=javascript>// replace the default admonitions block with one that looks like the antora output to apply similar styling via adoc.css
window.addEventListener('load', function () {
  const admonitions = document.getElementsByClassName('admonition-block')
  for (let i = admonitions.length - 1; i &gt;= 0; i--) {
    const elm = admonitions[i]
    const type = elm.classList[1]
    const text = elm.getElementsByTagName('p')[0].innerHTML
    const parent = elm.parentNode
    const tempDiv = document.createElement('div')
    tempDiv.innerHTML = `&lt;div class="admonitionblock ${type}"&gt;
    &lt;table&gt;
      &lt;tbody&gt;
        &lt;tr&gt;
          &lt;td class="icon"&gt;
            &lt;i class="fa icon-${type}" title="${type}"&gt;&lt;/i&gt;
          &lt;/td&gt;
          &lt;td class="content"&gt;
            ${text}
          &lt;/td&gt;
        &lt;/tr&gt;
      &lt;/tbody&gt;
    &lt;/table&gt;
  &lt;/div&gt;`

    const input = tempDiv.childNodes[0]
    parent.replaceChild(input, elm)
  }
})</code></pre></figure><p>In addition to generic table styling with padding, border and background colors the following lines are necessary to get admonitions with icons.
As the Javascript snippet assigns the <code>class="icon-${type}"</code> to each icon cell we can add specify their respective icon using Fontawesome unicodes.</p><figure class=listing-block><figcaption>adoc.css</figcaption><pre class=highlight><code class=language-css data-lang=css>.admonitionblock td.icon .icon-note:before {
  content: "\f05a";
  color: #19407c;
}
.admonitionblock td.icon .icon-warning:before {
  content: "\f071";
  color: #f38200;
}</code></pre></figure><p>This yields wonderful admonitions in the final output, the same you should see on this site.</p><figure class=image-block><img src=/assets/hugo-asciidoc/antora-admonitions.png alt="Final admonitions"><figcaption>Figure 3. Fixed admonitions with HTML source</figcaption></figure><hr><p>If you have any suggestions contact me via Twitter DM or leave a comment üëã</p><p>Title image by Vladimir Kramer on Unsplash</p></section></section></div><div class=footer><div class=tags><i class="fa fa-tags"></i><div class=links><a href=/tags/development>development</a>
<a href=/tags/web>web</a></div></div></div></article></div><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"anoff-io"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><footer><div class=container><div class=right><div class=external-profiles><strong>Social media</strong>
<a href=//twitter.com/an0xff target=_blank><i class="fa fa-twitter-adblock-proof"></i></a><a href=//github.com/anoff target=_blank><i class="fa fa-github"></i></a><a href=//linkedin.com/in/offenhaeuser/ target=_blank><i class="fa fa-linkedin"></i></a></div></div></div></footer><div class=credits><div class=container><div class=copyright><a href=//anoff.io target=_blank>&copy;
2019
by Andreas Offenhaeuser</a></div><div class=author><a href=//github.com/Lednerb/bilberry-hugo-theme target=_blank>Bilberry Hugo Theme</a></div></div></div><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-93890295-4','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src=/js/externalDependencies.39c47e10e241eae2947b3fe21809c572.js integrity="md5-OcR&#43;EOJB6uKUez/iGAnFcg=="></script><script type=text/javascript src=/js/theme.ff50ae6dc1bfc220b23bf69dbb41b54e.js integrity="md5-/1CubcG/wiCyO/adu0G1Tg=="></script><script>$(".moment").each(function(){$(this).text(moment($(this).text()).locale("en").format('LL'));});$(".footnote-return sup").html("");</script><script src=https://blog.anoff.io/fix-adoc.js type=application/javascript></script><script src=//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js type=application/javascript></script><script src=https://blog.anoff.io/init-cookieconsent.js type=application/javascript></script></body></html>