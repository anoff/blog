<!doctype html>
<html class="no-js" lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="author" content="Andreas Offenhaeuser">
        <meta name="description" content="Andreas&#39; personal blog">
        <meta name="keywords" content="blog,personal,software,architecture,node,markdown,plantuml,developer">
        <meta name="generator" content="Hugo 0.55.6" />
        <title> Continuous Vitae - Auto built and git versioned CV | Andreas&#39; Blog</title>
        <meta name="description" content="Continuous Vitae - Auto built and git versioned CV - Andreas&#39; personal blog">
        <meta itemprop="name" content="Continuous Vitae - Auto built and git versioned CV">
        <meta itemprop="description" content="Continuous Vitae - Auto built and git versioned CV - Andreas&#39; personal blog">
        <meta property="og:title" content="Continuous Vitae - Auto built and git versioned CV">
        <meta property="og:description" content="Continuous Vitae - Auto built and git versioned CV - Andreas&#39; personal blog">
        <meta property="og:image" content="/assets/continuous-cv/logo.png">
        <meta property="og:url" content="https://blog.anoff.io/2019-04-08-cv-continuous-vitae/">
        <meta property="og:site_name" content="Andreas&#39; Blog">
        <meta property="og:type" content="article">
        <link rel="icon" type="image/png" href="https://blog.anoff.io/favicon-32x32.png" sizes="32x32">
        <link rel="icon" type="image/png" href="https://blog.anoff.io/favicon-16x16.png" sizes="16x16">

	
	  <link href="/2019-04-08-cv-continuous-vitae/" rel="alternate" type="application/rss+xml" title="Andreas&#39; Blog" />
	  <link href="/2019-04-08-cv-continuous-vitae/" rel="feed" type="application/rss+xml" title="Andreas&#39; Blog" />
	

        
        
        
        
        <link rel="stylesheet" href="/sass/combined.min.e59b3a385f4eecf22b37689781c927e19eb7f9f3c17f6dc4704f3e8a26dece8c.css">

        

        
            
                <link rel="stylesheet" href="https://blog.anoff.io/adoc.css">
            
                <link rel="stylesheet" href="https://blog.anoff.io/overwrites.css">
            
                <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css">
            
        
    </head>
    <body class="bilberry-hugo-theme">
        
<nav class="permanentTopNav">

    <div class="container">
        <ul class="topnav">
            
                
                    <li><a href="//anoff.io/" target="_self">About me</a></li>
                
            
                
                    <li><a href="/" target="_self">Blog</a></li>
                
            
                
                    <li><a href="//anoff.io/project/" target="_self">Projects</a></li>
                
            
                
                    <li><a href="/tags" target="_self">by Tags</a></li>
                
            
                
                    <li><a href="//radar.anoff.io" target="_blank">Tech skills</a></li>
                
            
                
                    <li><a href="//anoff.github.io/legal/" target="_blank">Legal</a></li>
                
            
        </ul>

        
    </div>
</nav>


        <header>
    <div class="container">
        <div class="logo">
            <a href="/" class="logo">
                
                    <img src="/avatar.png" alt="">
                

                <span class="overlay"><i class="fa fa-child"></i></span>
            </a>
        </div>
        <div class="titles">
            <h3 class="title"><a href="/">Andreas&#39; Blog</a></h3>
            
                <span class="subtitle">Adventures of a software engineer/architect</span>
            
        </div>

    

        
        <div class="toggler permanentTopNav">
        
            <i class="fa fa-bars" aria-hidden="true"></i>
        </div>
    </div>
</header>


        <div class="main container">
            
     
    <div class="article-wrapper u-cf single">
        
            <a class="bubble" href="https://blog.anoff.io/2019-04-08-cv-continuous-vitae/">
    <i class="fa fa-fw fa-code"></i>
</a>

<article class="default article">
    
    <div class="featured-image">
        <a href="https://blog.anoff.io/2019-04-08-cv-continuous-vitae/">
            <img src="/assets/continuous-cv/logo.png" alt="">
        </a>
    </div>


    <div class="content">
    <h3><a href="https://blog.anoff.io/2019-04-08-cv-continuous-vitae/">Continuous Vitae - Auto built and git versioned CV</a></h3>
    <div class="meta">
        
            
                <span class="date moment">2019-04-08</span>
            
        

        
            <span class="readingTime">6 min read</span>
        

        

        
            <span class="author"><a href="/author/anoff">anoff</a></span>
        
    </div>

    
        <div class="paragraph">
<p>Versioning your CV is important.
One traditional approach is to date it whenever you send it out.
I chose to present my CV on my <a href="https://anoff.io">website</a> and host it on GitHub.
In this blog post I want to explain how I set up continuous integration pipeline for building my CV that automatically injects a unique version into each build.
This method is applicable for anyone choosing to ascii-based CV - in my case LaTeX.
You also need some basic knowledge of <code>git</code>, <code>Docker</code> and CI services like <code>Drone</code>.</p>
</div>
<div class="sect1">
<h2 id="_the_starting_point">The Starting point</h2>
<div class="sectionbody">
<div class="paragraph">
<p>My CV is presented on a statically generated web page.
I recently changed this page to use <a href="/2019-02-17-hugo-render-asciidoc">Hugo</a> for rendering.
Before automating the CV I built it locally using a <code>Makefile</code> and commit the generated PDF file into <code>git</code> repository as artifact.</p>
</div>
<div class="listingblock">
<div class="title">Makefile</div>
<div class="content">
<pre class="highlight"><code class="language-make" data-lang="make">.PHONY: pdf inject-git-version verify-git-clean clean commit
COMMIT_SHA := $(shell git rev-parse --short=8 HEAD) <b class="conum">(1)</b>
FILE_TEX := ./cv-anoff.tex# latex filename

verify-git-clean:
	git diff-index --quiet HEAD <b class="conum">(2)</b>
inject-git-version:
	sed -i.bak 's/\({git:\)[[:alnum:]]*\(}\)/\1${COMMIT_SHA}\2/' ${FILE_TEX} <b class="conum">(3)</b>
pdf:
	docker run -v ${CURDIR}:/doc/ -t -i thomasweise/texlive lualatex.sh ${FILE_TEX} <b class="conum">(4)</b>
clean:
	mv ${FILE_TEX}.bak ${FILE_TEX}
commit:
	git commit -am ":construction_worker: build: CV update"
build: verify-git-clean inject-git-version pdf clean commit</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Get the first 8 character of the current git revision e.g. 11187f1</p>
</li>
<li>
<p>Make sure there are no uncommitted changes in the directory</p>
</li>
<li>
<p>Replace the placeholder in the <code>.tex</code> file with the git revision</p>
</li>
<li>
<p>Run the LaTeX pdf generation via Docker</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The placeholder in the LaTeX file is <code>{git:COMMITID}</code>.
To make sure the replace operation matches only this one place I also added the surrounding curly braces to the matching string.
If your LaTeX file has a different setup you may need to modify the regular expression in the <code>Makefile</code>.</p>
</div>
<div class="listingblock">
<div class="title">cv-anoff.tex</div>
<div class="content">
<pre class="highlight"><code class="language-latex" data-lang="latex">\begin{document}

\header{andreas}{of\/fenhaeuser}{software engineer/architect}{git:COMMITID}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally rendered you will see something like this</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/continuous-cv/git-version.png" alt="git SHA in PDF">
</div>
<div class="title">Figure 1. git SHA as CV version</div>
</div>
<div class="paragraph">
<p>The complete workflow to update the CV:</p>
</div>
<div class="literalblock">
<div class="title">Manual CV generation</div>
<div class="content">
<pre>@startuml
skinparam monochrome true
|Local (git)|
start
:modify LaTeX file;
:commit changes;
:run &lt;i&gt;Makefile;
:commit updated PDF;
:push changes;
|Build pipeline|
:generate static web page
treating CV (PDF) as an artifact;
:upload static web page;
|Web Server|
:provide web page;
|Viewer|
:enjoy my CV;
stop
@enduml</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_issues">The Issues</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are a number of things that I did not like about my old setup:</p>
</div>
<div class="olist arabic">
<div class="title">Annoyances to get rid off</div>
<ol class="arabic">
<li>
<p>need to commit twice to make a change</p>
</li>
<li>
<p>artifacts are checked into <code>git</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>But also some things I really like about it:</p>
</div>
<div class="olist arabic">
<div class="title">Features to keep</div>
<ol class="arabic">
<li>
<p>PDF can be previewed locally</p>
</li>
<li>
<p>exact version of a CV can easily be viewed on GitHub</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_goal">The Goal</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Given the pros and cons I was aiming for a workflow that generates artifacts on the server but allows me to preview them locally as much as possible.
My ideal workflow for the web hosted CV is the following:</p>
</div>
<div class="literalblock">
<div class="title">Continuous Vitae generation</div>
<div class="content">
<pre>@startuml
skinparam monochrome true
|Local (git)|
start
:modify LaTeX file;
:commit changes;
:push changes;
|Build pipeline|
:inject git version;
:generate PDF;
:generate static web page
treating CV (PDF) as an artifact;
:upload static web page;
|Web Server|
:provide web page;
|Viewer|
:enjoy my CV;
stop
@enduml</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_solution">The Solution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As with all my latest projects <a href="http://drone.io/">drone</a> is the continuous integration service of choice.
The main challenge is to split the <code>Makefile</code> up into individual drone <a href="https://docs.drone.io/user-guide/pipeline/steps/">pipeline steps</a>.</p>
</div>
<div class="sect2">
<h3 id="_get_the_git_commit_as_cv_version">Get the git commit as CV version</h3>
<div class="paragraph">
<p>With the old workflow the CV version is only updated whenever I ran the <code>Makefile</code> and take the current git commit SHA as a version.
Using a continuous build approach this would be run for each commit.
As the CV is versioned &amp; built within my website this would result in a new CV version even if the CV was not updated.
Therefore the current way to get a version needs to be changed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash"># OLD: using the current HEAD revision of the repo
git diff-index --quiet HEAD

# NEW: HEAD revision of a specific file
git rev-list --abbrev-commit -1 HEAD cv-anoff.tex</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drone_ci_config">Drone CI Config</h3>
<div class="paragraph">
<p>This tutorial will not cover how to set up drone, there are plenty of articles out there for that.
The drone config file covers only on the CV specific steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>get the commit ID of the latest CV version</p>
</li>
<li>
<p>inject commit ID as version into the CV</p>
</li>
<li>
<p>build the CV using docker LaTeX container</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Things that you might want to do after these steps are creating your static site using Hugo/Jekyll/Gatsby.. and publishing it via zeit/surge/gh-pages.. So many options ðŸ¤¯</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This is written with drone 1.0 syntax
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Drone steps for versioned CV PDF generation</div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">kind: pipeline
name: deploy

steps:
- name: fetch-version
  image: alpine/git
  commands:
  - git rev-list --abbrev-commit -1 HEAD cv-anoff.tex &gt; .COMMIT_SHA

- name: build-cv
  image: thomasweise/texlive
  commands:
  - export COMMIT_SHA=$(cat .COMMIT_SHA)
  - sed -i.bak "s/\({git:\)[[:alnum:]]*\(}\)/\1"$COMMIT_SHA"\2/" cv-anoff.tex
  - lualatex.sh cv-anoff.tex || echo "Ignoring original.pdf error"<b class="conum">(1)</b>
  - mv cv-anoff.tex.bak cv-anoff.tex</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The build currently tries to manipulate a file that does not exist as part of a post-processing routine and fails; however the expected output exists so the <code>luatex</code> command may fail in this case</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Note that the steps from the original <code>Makefile</code> are not just executed sequentially in a single step.
That is mainly due to the fact that the <em>thomasweise/texlive</em> Docker image does not include <code>git</code>.
Instead of creating yet another docker image with all the dependencies needed (don&#8217;t be that person please) we can instead create a sequential build and separate those concerns.</p>
</div>
<div class="paragraph">
<p>The first step <em>fetch-version</em> executes the git command to get the correct SHA.
This is stored in a temporary file to be passed into the next pipeline step.
The <em>build-cv</em> step uses <code>sed</code> to replace the version placeholder with the commit SHA and execute the PDF build using <code>luatex</code>.</p>
</div>
<div class="paragraph">
<p>The PDF is placed next to the input so it is best to place the <code>.tex</code> file itself into a folder that is served as static asset.
Otherwise you may need an additional post processing step to move the file to an accessible location.</p>
</div>
</div>
<div class="sect2">
<h3 id="_support_local_build">Support local build</h3>
<div class="paragraph">
<p>There are two easy ways to support the <em>create a local CV preview</em> feature.</p>
</div>
<div class="paragraph">
<p>The first being the original <code>Makefile</code> - it used to work and it still does work.
You may want to remove the <code>git commit</code> step from the <code>Makefile</code> though and add the <code>.pdf</code> file itself onto <code>.gitignore</code> to make sure the preview stays local.
Downside of this option is you may need to patch code at two different locations.</p>
</div>
<div class="paragraph">
<p>The second option is to use <strong>drone</strong> and its awesome <strong>drone CLI</strong> support to run parts of the pipeline locally.
To achieve this install the <a href="https://docs.drone.io/cli/install/">drone CLI</a> and either copy&amp;paste or put the following line into a script file.</p>
</div>
<div class="listingblock">
<div class="title">local CV generation</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">drone exec --include fetch-version --include build-cv</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/continuous-cv/drone-exec.png" alt="CLI output">
</div>
<div class="title">Figure 2. Drone CLI output for local execution</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_summary">Summary</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We started out with scripting <strong>git versioning</strong> a LaTeX based document.
Then we used a <code>Makefile</code> to keep all the commands needed to automate the CV generation in one place.
In the final step I we from scripted and manually executed to scripted and <strong>fully automated generation</strong> of the PDF using the Drone continuous integration service.</p>
</div>
<div class="paragraph">
<p>If you have any questions DM me on Twitter <a href="https://twitter.com/anoff_io">anoff_io</a> or leave a comment ðŸ‘‹</p>
</div>
</div>
</div>

    
</div>

    
<div class="footer">


    
        <div class="tags">
            <i class="fa fa-tags"></i>
            <div class="links">
                
                    <a href="/tags/recruiting">recruiting</a>
                
                    <a href="/tags/ci/cd">CI/CD</a>
                
                    <a href="/tags/drone">drone</a>
                
            </div>
        </div>
    

    
</div>

</article>

        
    </div>

    
        <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "anoff-io" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    

     

        </div>

        
<footer>
    <div class="container">

        

        

        <div class="right">
            
            <div class="external-profiles">
                <strong>Social media</strong>

                
                
                    <a href="//twitter.com/anoff_io" target="_blank"><i class="fa fa-twitter-adblock-proof"></i></a>
                
                
                
                
                
                
                
                
                
                    <a href="//github.com/anoff" target="_blank"><i class="fa fa-github"></i></a>
                
                
                    <a href="//linkedin.com/in/offenhaeuser/" target="_blank"><i class="fa fa-linkedin"></i></a>
                
            </div>
            

            
        </div>
    </div>
</footer>


<div class="credits">
    <div class="container">
        <div class="copyright">
            <a href="//anoff.io" target="_blank">
                &copy;
                
                    2019
                
                by Andreas Offenhaeuser
            </a>
	    
        </div>
        <div class="author">
            <a href="//github.com/Lednerb/bilberry-hugo-theme" target="_blank">Bilberry Hugo Theme</a>
        </div>
    </div>
</div>


        
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-93890295-4', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


        

        
        
        <script type="text/javascript" src="/js/externalDependencies.d9216f6db8fba82175fa5f40d0bb9b8c.js" integrity="md5-2SFvbbj7qCF1&#43;l9A0LubjA=="></script>

        
        
        <script type="text/javascript" src="/js/theme.d1b29b9e0ef43ea877f514c7e101a399.js" integrity="md5-0bKbng70Pqh39RTH4QGjmQ=="></script>

        <script>
            $(".moment").each(function() {
                $(this).text(
                    moment( $(this).text() )
                        .locale( "en" )
                        .format('LL')
                );
            });

            $(".footnote-return sup").html("");
        </script>

        
            
                <script src="https://blog.anoff.io/fix-adoc.js" type="application/javascript"></script>
            
                <script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js" type="application/javascript"></script>
            
                <script src="https://blog.anoff.io/init-cookieconsent.js" type="application/javascript"></script>
            
        

        


    </body>
</html>
